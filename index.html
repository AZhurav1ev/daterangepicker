<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./codebase/webix.min.js"></script>
    <link rel="stylesheet" href="./codebase/webix.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <title>Document</title>
</head>

<body>
    <script src="./pdf-response.js"></script>
    <script>
        function openSaveFileDialog(data, filename, mimetype) {

            if (!data) return;

            var blob = data.constructor !== Blob
                ? new Blob([data], { type: mimetype || 'application/octet-stream' })
                : data;

            if (navigator.msSaveBlob) {
                navigator.msSaveBlob(blob, filename);
                return;
            }

            var lnk = document.createElement('a'),
                url = window.URL,
                objectURL;

            if (mimetype) {
                lnk.type = mimetype;
            }

            lnk.download = filename || 'untitled';
            lnk.href = objectURL = url.createObjectURL(blob);
            lnk.dispatchEvent(new MouseEvent('click'));
            setTimeout(url.revokeObjectURL.bind(url, objectURL));
        }

        webix.ready(function () {
            webix.ui({
                rows: [
                    { gravity: 0.3 },
                    {
                        cols: [
                            { gravity: 0.5 },
                            {
                                rows: [
                                    { template: `version 703 - new custom doenload`, autoheight: true },
                                    { view: "pdfbar", id: "toolbar" },
                                    { view: "pdfviewer", id: "pdf", toolbar: "toolbar" },
                                    {
                                        view: "button",
                                        value: "custom download",
                                        css: "webix_primary",
                                        autowidth: true,

                                        click: function () {
                                            $$("pdf").$pdfDoc.getData().then((data) => {
                                                openSaveFileDialog(data, "test", "application/pdf")
                                            })
                                        }
                                    }
                                ]
                            },
                            { gravity: 0.5 }

                        ]
                    },
                    { gravity: 0.3 }
                ]
            });
            setTimeout(() => {
                let lcPDFData = atob(PdfContent);
                lcFileName = { "data": lcPDFData };
                $$("pdf").parse(lcFileName);
            }, 100);
        });
    </script>
</body>

</html>
