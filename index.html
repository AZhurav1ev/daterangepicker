<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./codebase/webix.min.js"></script>
    <link rel="stylesheet" href="./codebase/webix.min.css">
    <title>Multi download test</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>

<body>
    <script src="browser.js"></script>
    <script src="pdfdoc.js"></script>
    <script src="csvData.js"></script>
    <script>
        webix.ready(function () {
            webix.ui({
                rows: [
                    {},
                    {
                        cols: [
                            {},
                            {
                                rows: [
                                    { template: `version 2.0`, autoheight: true, borderless: true },
                                    {
                                        view: "button",
                                        value: "Download csv",
                                        autowidth: true,
                                        click: function (e) {
                                            var json_pre = '[{"Id":1,"UserName":"Sam Smith"},{"Id":2,"UserName":"Fred Frankly"},{"Id":1,"UserName":"Zachary Zupers"}]';
                                            var json = $.parseJSON(json_pre);

                                            var csv = JSON2CSV(json);
                                            var downloadLink = document.createElement("a");
                                            var blob = new Blob(["\ufeff", csv]);
                                            var url = URL.createObjectURL(blob);
                                            downloadLink.href = url;
                                            downloadLink.download = "data.csv";

                                            document.body.appendChild(downloadLink);
                                            downloadLink.click();
                                            document.body.removeChild(downloadLink);



                                            // Solution for apple developers
                                            // const urlArray = [];
                                            // for (let i = 0; i < 3; i++) {
                                            //     urlArray.push('data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent));
                                            // }
                                            // urlArray.forEach((url, index) => {
                                            //     var link = document.createElement("a");
                                            //     link.download = `test${index}.csv`;
                                            //     link.target = "_blank";
                                            //     // Construct the URI 
                                            //     link.href = url;
                                            //     document.body.appendChild(link);
                                            //     setTimeout(function () {
                                            //         link.click();
                                            //         // Cleanup the DOM 
                                            //         // document.body.removeChild(link);
                                            //     }, 500 * index);
                                            // });




                                            // Partial working solution
                                            // e.preventDefault();
                                            // const urlArray = [];
                                            // for (let i = 0; i < 3; i++) {
                                            //     urlArray.push('data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent));
                                            // }
                                            // multiDownload([urlArray], { rename: ({ index }) => `test.csv` });

                                            //working solution for one file
                                            // let dataUrl = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
                                            // let link = document.createElement('a');
                                            // link.download = 'test.csv';
                                            // link.href = dataUrl;

                                            // document.body.appendChild(link);
                                            // link.click();
                                            // document.body.removeChild(link);
                                        }
                                    }
                                ]
                            },
                            {}
                        ]
                    },
                    {}
                ]
            });
        });
    </script>
</body>

</html>