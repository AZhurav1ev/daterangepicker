<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./codebase/webix.min.js"></script>
    <link rel="stylesheet" href="./codebase/webix.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <title>Document</title>
</head>

<body>
    <script src="./pdf-response.js"></script>
         <script>
        function iOSversion() {
            if (/iP(hone|od|ad)/.test(navigator.platform)) {
                var v = (navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d+)?/);
                return parseInt(v[1], 10);
            }
        }

        function isIOS() {
            return (/iPad|iPhone|iPod/.test(navigator.platform) ||
                (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&
                !window.MSStream
        }

        function isSafari() {
            return navigator.vendor && navigator.vendor.indexOf('Apple') > -1 &&
                navigator.userAgent &&
                navigator.userAgent.indexOf('CriOS') == -1 &&
                navigator.userAgent.indexOf('FxiOS') == -1;
        }

        function iosHigherVersions(data, filename, mimetype) {
            if (!data) return;
            var blob = data.constructor !== Blob
                ? new Blob([data], { type: mimetype || 'application/octet-stream' })
                : data;
            if (navigator.msSaveBlob) {
                navigator.msSaveBlob(blob, filename);
                return;
            }
            var link = document.createElement('a'),
                url = window.URL,
                objectURL;
            if (mimetype) {
                link.type = mimetype;
            }
            link.download = filename || 'untitled';

            link.href = objectURL = url.createObjectURL(blob);
            link.dispatchEvent(new MouseEvent('click'));
            setTimeout(url.revokeObjectURL.bind(url, objectURL));
        }

        function iosLowerVersions(data, filename, mimetype) {
            var blob = new Blob([data]);
            var a = window.document.createElement("a");
            a.href = window.URL.createObjectURL(blob, { type: mimetype });
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }


        webix.ready(function () {
            webix.ui({
                rows: [
                    { gravity: 0.3 },
                    {
                        cols: [
                            { gravity: 0.5 },
                            {
                                rows: [
                                    { template: `version 703, latest`, autoheight: true },
                                    { view: "pdfbar", id: "toolbar" },
                                    { view: "pdfviewer", id: "pdf", toolbar: "toolbar" },
                                    {
                                        view: "button",
                                        value: "custom download",
                                        css: "webix_primary",
                                        autowidth: true,
                                        click: function () {
                                            if (isIOS() && iOSversion() > 12) {
                                                $$("pdf").$pdfDoc.getData().then((data) => {
                                                    iosHigherVersions(data, "test", "application/pdf")
                                                });
                                            } else {
                                                $$("pdf").$pdfDoc.getData().then((data) => {
                                                    iosHigherVersions(data, 'test', "application/pdf")
                                                });
                                            }
                                        }
                                    }
                                ]
                            },
                            { gravity: 0.5 }

                        ]
                    },
                    { gravity: 0.3 }
                ]
            });
            setTimeout(() => {
                let lcPDFData = atob(PdfContent);
                lcFileName = { "data": lcPDFData };
                $$("pdf").parse(lcFileName);
            }, 100);
        });
    </script>
</body>

</html>
